# 飞书分享插件 - 安装和配置指南

## 📦 安装步骤

### 1. 手动安装（推荐）

1. **下载插件文件**
   - 将项目文件复制到 Obsidian 插件目录：
   - `{你的笔记库}/.obsidian/plugins/obsidian-feishu-share/`

2. **启用插件**
   - 打开 Obsidian 设置
   - 进入"第三方插件"页面
   - 找到"飞书分享"插件并启用

### 2. 开发者安装

```bash
# 在你的 Obsidian 插件目录中
cd {vault}/.obsidian/plugins/
git clone https://github.com/your-repo/obsidian-feishu-share.git
cd obsidian-feishu-share
npm install
npm run build
```

## 🔧 配置步骤

### 第一步：创建飞书应用

1. **访问飞书开放平台**
   - 打开 [https://open.feishu.cn/app](https://open.feishu.cn/app)
   - 使用飞书账号登录

2. **创建应用**
   - 点击"创建企业自建应用"或"创建个人应用"
   - 填写应用名称：`Obsidian 飞书分享`
   - 填写应用描述：`用于将 Obsidian 笔记分享到飞书的插件`

3. **配置应用信息**
   - 在应用管理页面，记录下 **App ID** 和 **App Secret**
   - 在"安全设置"中添加重定向 URL：`obsidian://feishu-share-callback`

4. **申请权限**
   在"权限管理"页面申请以下权限：
   - `contact:user.base:readonly` - 读取用户基本信息
   - `docs:doc:create` - 创建文档
   - `drive:explorer:readonly` - 读取文件夹列表

### 第二步：配置插件

1. **打开插件设置**
   - 在 Obsidian 中，进入设置 → 第三方插件 → 飞书分享

2. **填写应用配置**
   - **App ID**：填入第一步中获得的 App ID
   - **App Secret**：填入第一步中获得的 App Secret

3. **完成授权**
   - 点击"开始授权"按钮
   - 在弹出的飞书页面中登录并确认授权
   - 授权成功后会显示"已授权"状态

### 第三步：配置文件夹（可选）

1. **选择默认文件夹**
   - 在插件设置中点击"选择文件夹"
   - 在弹出的文件夹选择界面中浏览并选择目标文件夹
   - 如果不选择，文档将默认创建在"我的空间"根目录

## 🚀 使用方法

### 分享单个文档

1. **打开 Markdown 文件**
   - 在 Obsidian 中打开要分享的 `.md` 文件

2. **执行分享**
   - 方法一：点击右上角菜单中的"分享到飞书"
   - 方法二：右键点击文件，选择"分享到飞书"
   - 方法三：使用命令面板（Ctrl/Cmd + P），搜索"分享到飞书"

3. **查看结果**
   - 分享成功后会显示通知，包含飞书文档链接
   - 点击通知或复制链接即可访问飞书文档

### 内容处理说明

**✅ 完全支持的格式：**
- 标准 Markdown 语法（标题、段落、列表、粗体、斜体、代码块等）
- 网络图片链接（http/https）
- 表格、引用块、链接

**⚠️ 转换处理的格式：**
- `[[双向链接]]` → `📝 链接名`
- `![[嵌入文件]]` → `📎 嵌入文件：文件名`
- 本地图片 → `🖼️ 本地图片：文件名 (需要手动上传到飞书)`

**❌ 不支持的格式：**
- 本地图片文件的自动上传
- Obsidian 插件特有的扩展语法

## 🔍 故障排除

### 常见问题

1. **授权失败**
   - 检查 App ID 和 App Secret 是否正确
   - 确认重定向 URL 配置为：`obsidian://feishu-share-callback`
   - 检查应用权限是否已申请并通过

2. **分享失败**
   - 确认已完成授权且状态为"已授权"
   - 检查网络连接是否正常
   - 查看 Obsidian 开发者控制台的错误信息

3. **文件夹选择失败**
   - 确认已授权 `drive:explorer:readonly` 权限
   - 检查网络连接
   - 尝试重新授权

### 错误代码说明

| 错误码 | 说明 | 解决方法 |
|--------|------|----------|
| 99991663 | access_token 无效或已过期 | 重新授权 |
| 99991665 | 应用权限不足 | 检查应用权限配置 |
| 230001 | 文档标题不能为空 | 确保文件名不为空 |
| 230004 | 文件夹不存在或无权限访问 | 重新选择文件夹或使用默认位置 |

## 📞 技术支持

如果遇到问题，请：

1. 查看 Obsidian 开发者控制台（Ctrl/Cmd + Shift + I）的错误信息
2. 确认飞书应用配置是否正确
3. 检查网络连接和防火墙设置
4. 提交 Issue 时请包含详细的错误信息和复现步骤

## 🔄 更新日志

### v1.0.0
- ✅ 基础分享功能
- ✅ OAuth 2.0 授权
- ✅ 交互式文件夹选择
- ✅ Obsidian 语法转换
- ✅ 中文错误信息
